<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GuavaDocs</title>
  <style>
    body {
      background-color: #1d0e22;
      color: #f5f3b9;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
    }

    header {
      background: #86c232;
      color: #1d0e22;
      padding: 1rem 2rem;
      font-size: 2rem;
      font-weight: bold;
    }

    .content {
      padding: 2rem;
    }

    .description {
      margin-bottom: 2rem;
      font-size: 1.1rem;
      line-height: 1.5;
      color: #f5f3b9;
    }

    .import-entry {
      background: #29142e;
      margin-bottom: 1rem;
      border: 1px solid #ff6f91;
      border-radius: 8px;
      overflow: hidden;
    }

    .entry-header {
      padding: 1rem;
      background: #3d1e45;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .entry-header:hover {
      background: #512356;
    }

    .entry-body {
      display: none;
      padding: 1rem;
      border-top: 1px solid #ff6f91;
    }

    .entry-body pre {
      white-space: pre-wrap;
      background: #121212;
      padding: 1rem;
      border-radius: 6px;
      color: #f5f3b9;
      overflow-x: auto;
      max-height: 200px;
    }

    .show-more {
      display: inline-block;
      color: #ff6f91;
      cursor: pointer;
      margin-top: 0.5rem;
    }

    a {
      color: #86c232;
    }

    code {
      font-family: monospace;
      background: #2a2a2a;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
    }

    .tag {
      background: #86c232;
      color: #1d0e22;
      padding: 0.2rem 0.5rem;
      margin-right: 0.4rem;
      border-radius: 4px;
      font-size: 0.85rem;
      display: inline-block;
    }
  </style>
</head>
<body>
  <header>GuavaDocs</header>
  <div class="content">
    <div class="description">
      A collection of remote-importable libraries with usage guides and cryptographic hashes. Click on a module below to expand.
    </div>
    <div id="imports"></div>
  </div>

  <script>
    async function fetchIndex() {
      const index = await fetch('./imports/index.json').then(res => res.json());
      return index;
    }

    async function fetchImport(name) {
      const data = await fetch(`./imports/${name}.json`).then(res => res.json());
      return data;
    }

    function createEntry(name, data) {
      const entry = document.createElement('div');
      entry.className = 'import-entry';

      const header = document.createElement('div');
      header.className = 'entry-header';
      header.textContent = data.importName || name;

      const body = document.createElement('div');
      body.className = 'entry-body';

      const tagList = data.tags.map(tag => `<span class="tag">${tag}</span>`).join('');

      const info = `
        <h3>${data.title}</h3>
        <p><strong>Description:</strong> ${data.description}</p>
        <p><strong>Use:</strong><br/><code>${data.use.replace(/\n/g, '<br/>')}</code></p>
        <p><strong>Library:</strong> <a href="${data.libraryRepoUrl}" target="_blank">${data.libraryName}</a> (v${data.libraryVersion})</p>
        <p><strong>GuavaDocs:</strong> <a href="${data.guavaDocsUrl}" target="_blank">${data.guavaDocsUrl}</a></p>
        <p><strong>Signatures:</strong><br/>
          MD5: ${data.codeSignature['MD5']}<br/>
          SHA-1: ${data.codeSignature['SHA-1']}<br/>
          SHA-256: ${data.codeSignature['SHA-256']}<br/>
          SHA-384: ${data.codeSignature['SHA-384']}<br/>
          SHA-512: ${data.codeSignature['SHA-512']}
        </p>
        <p><strong>Eval Type:</strong> ${data.evalType}</p>
        <p><strong>Global:</strong> ${data.global}</p>
        <p><strong>Authors:</strong> ${data.author.join(', ')}</p>
        <p><strong>Copyright:</strong><br/> ${data.copyright.join('<br/>')}</p>
        <p><strong>License:</strong><br/> <a href="${data.licenseUrl}" target="_blank">${data.licenseName}</a><br/>${data.license.replace(/\n/g, '<br/>')}</p>
        <p><strong>Tags:</strong> ${tagList}</p>
        <p><strong>Code:</strong></p>
        <pre>${data.code.slice(0, 500)}</pre>
        ${data.code.length > 500 ? `<span class="show-more" onclick="this.previousElementSibling.textContent = \`${data.code.replace(/`/g, '\\`')}\`; this.remove()">Show full code</span>` : ''}
      `;

      body.innerHTML = info;

      header.onclick = () => {
        body.style.display = body.style.display === 'block' ? 'none' : 'block';
      };

      entry.appendChild(header);
      entry.appendChild(body);
      return entry;
    }

    async function renderImports() {
      const imports = await fetchIndex();
      const container = document.getElementById('imports');

      for (const name of imports) {
        const data = await fetchImport(name);
        const entry = createEntry(name, data);
        container.appendChild(entry);
      }
    }

    renderImports();
  </script>
</body>
</html>
